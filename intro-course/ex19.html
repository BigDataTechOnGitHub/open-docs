
<html>
<head>
    <title>Mesosphere - Exercise 19: Troubleshooting</title>
    <meta name="title" content ="Mesosphere Documentation Intro Course">

    <meta name="description" content="Mesos allows you to create a highly-available and scalable cluster on your existing hardware.">

    <meta name="keywords" content="mesos, mesosphere, apache mesos, cluster, mesos cluster, apache mesos, mesos tutorial, ETL, long-running services, service automation, distributed kernel, apache marathon, marathon tutorial, chronos tutorial, spark tutorial">
    <meta name="googlebot" content="all" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.min.css"
          rel="stylesheet">
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css"
          rel="stylesheet">
    <link rel="stylesheet" href="/assets/mesosphere-bb1dd6431996c0a6e479673c87a06efc.css">
    <link rel="alternate" type="application/atom+xml" title="The Mesosphere Blog" href="/blog/atom.xml">
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/assets/apple-touch-icon-114x114-precomposed-866a1e471ec7ca6bd71446ca972285c6.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/assets/apple-touch-icon-72x72-precomposed-4a308d281d978c5a39fd1893ca051959.png">
    <link rel="apple-touch-icon-precomposed" href="/assets/apple-touch-icon-57x57-precomposed-d7a5a878dcc95e57717cc774eeac8c22.png">

    <link rel="stylesheet" href="style.css">
    <script src="//cdn.optimizely.com/js/2009520669.js"></script>
    <script>
        window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
                window.analytics.load("7sgtwqvuai");
        window.analytics.page();
    </script>

</head>
<body>

<div class="navbar navbar-default  " role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>


            <a class="navbar-brand" href="http://mesosphere.com/">


                <img src="http://dw8zztroqvu2r.cloudfront.net/assets/mesosphere-165b872607f4d76434d9b1cfb41a6280.png" width="148" height="25" alt="Mesosphere">


            </a>
        </div>
        <div class="collapse navbar-collapse">
        </div>
    </div>
</div>

<div class="body-light">
    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <div role="complementary">
                    <gcse:searchbox-only></gcse:searchbox-only>
                    <ul class="nav docs-sidenav">
                        <li><a class="reference external" href="intro.html">Introduction</a></li>
                        <li><a class="reference external" href="ex1.html">01: Installing Software</a></li>
                        <li><a class="reference external" href="ex2.html">02: Installing ZooKeeper</a></li>
                        <li><a class="reference external" href="ex3.html">03: Using Apache Mesos</a></li>
                        <li><a class="reference external" href="ex4.html">04: Starting Marathon</a></li>
                        <li><a class="reference external" href="ex5.html">05: Using the Marathon GUI</a></li>
                        <li><a class="reference external" href="ex6.html">06: Marathon REST API</a></li>
                        <li><a class="reference external" href="ex7.html">07: Building and Running Mesos DNS</a></li>
                        <li><a class="reference external" href="ex8.html">08: Installing Chronos</a></li>
                        <li><a class="reference external" href="ex9.html">09: Creating A Slave Node</a></li>
                        <li><a class="reference external" href="ex10.html">10: Installing Mesos</a></li>
                        <li><a class="reference external" href="ex11.html">11: Scaling To Two Nodes</a></li>
                        <li><a class="reference external" href="ex12.html">12: Deploying A Web App With Docker</a></li>
                        <li><a class="reference external" href="ex13.html">13: Distributing Docker To Multiple Nodes</a></li>
                        <li><a class="reference external" href="ex14.html">14: Installing and Using Mesos CLI</a></li>
                        <li><a class="reference external" href="ex15.html">15: Starting Four Nodes</a></li>
                        <li><a class="reference external" href="ex16.html">16: Recreating the Cluster Using Ansible</a></li>
                        <li><a class="reference external" href="ex17.html">17: Advanced Usage of the Marathon</a></li>
                        <li><a class="reference external" href="ex18.html">18: Advanced Usage of Chronos</a></li>
                        <li><a class="reference external" href="ex19.html">19: Troubleshooting</a></li>
                        <li><a class="reference external" href="ex20.html">20: Advanced Cluster Building</a></li>
                    </ul>
                </div>

            </div>
            <div class="col-md-8">

                <!--- RST STARTS -->
                <h1 class="title">Exercise 19: Troubleshooting</h1>
                <p>This exercise teaches you how to debug your tiny cluster when things go
wrong.</p>
<p>In this exercise:
* Cause errors and then use the tools available to you to troubleshoot.
* Reconfigure rsyslog so that it routes all of the Mesos, Chronos, and Marathon messages to <tt class="docutils literal">/var/log/mesos/</tt> files
rather than to the <tt class="docutils literal">/var/log/messages</tt> file.</p>
<div class="section" id="video-lecture">
<h1>Video Lecture</h1>
<style>.smart-player-embed-container-iframe{width:768px;height:576px}.smart-player-full-frame-mode{position:absolute;top:0;left:0;z-index:10;width:100%;height:100%;padding:0;margin:0}</style>
<div class="video-lecture-container">
        <iframe class="smart-player-embed-container-iframe" id="embeddedSmartPlayerInstance" src="https://s3-us-west-2.amazonaws.com/docs-staging.mesosphere.com/Videos/Mesos-Intro-Course-19/media/index_player.html?embedIFrameId=embeddedSmartPlayerInstance" scrolling="no"  frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
    </div>
<script src="media/scripts/embedded-smart-player.min.js"></script></div>
<div class="section" id="quick-reference">
<h1>Quick Reference</h1>
<p>When there are problems they are stored here by default:</p>
<ul class="simple">
<li>The <tt class="docutils literal">/var/log/mesos</tt> directory contains many logging files.</li>
<li>The <tt class="docutils literal">/var/log/messages</tt> file contains many of the syslog messages.</li>
</ul>
<p>To simplify troubleshooting, create a configuration file in <tt class="docutils literal">/etc/rsyslog.d/</tt> that sorts the messages into four different message types: Marathon, Chronos, Mesos master, and Mesos slave.  Create the file <tt class="docutils literal">/etc/rsyslog.d/mesos.conf</tt> with these contents:</p>
<div class="highlight"><pre><a name="code--ex19--mesos.conf.txt-jinja-idio.html-1"></a>if $programname == &#39;marathon&#39; then {
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-2"></a>   action(type=&quot;omfile&quot; file=&quot;/var/log/mesos/marathon.log&quot;)
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-3"></a>}
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-4"></a>
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-5"></a>if $programname == &#39;chronos&#39; then {
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-6"></a>   action(type=&quot;omfile&quot; file=&quot;/var/log/mesos/chronos.log&quot;)
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-7"></a>}
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-8"></a>
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-9"></a>if $programname == &#39;mesos-master&#39; then {
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-10"></a>   action(type=&quot;omfile&quot; file=&quot;/var/log/mesos/mesos-master.log&quot;)
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-11"></a>}
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-12"></a>
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-13"></a>if $programname == &#39;mesos-slave&#39; then {
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-14"></a>   action(type=&quot;omfile&quot; file=&quot;/var/log/mesos/mesos-slave.log&quot;)
<a name="code--ex19--mesos.conf.txt-jinja-idio.html-15"></a>}
</pre></div><p>Restart <tt class="docutils literal">rsyslog</tt> to verify that this configuration works:</p>
<div class="highlight"><pre><a name="code--ex19--configure.sh-session-jinja-idio.html-1"></a><span class="gp">$</span> sudo service rsyslog restart
</pre></div><p>If successful, you should see new log files in <tt class="docutils literal">/var/log/mesos/</tt>:</p>
<blockquote>
<ol class="arabic simple">
<li><tt class="docutils literal">/var/log/mesos/marathon.log</tt> contains the Marathon related messages.</li>
<li><tt class="docutils literal">/var/log/mesos/chronos.log</tt> contains the Chronos relates messages.</li>
<li><tt class="docutils literal"><span class="pre">/var/log/mesos/mesos-master.log</span></tt> has the Mesos master messages.</li>
<li><tt class="docutils literal"><span class="pre">/var/log/mesos/mesos-slave.log</span></tt> has the Mesos slave messages.</li>
</ol>
</blockquote>
<p>In general you'll put this on the mesos master nodes you make, but you could cut this down and also put it on the slave nodes too for just the slave messages.</p>
<p>Copy it to the <tt class="docutils literal">/vagrant/mesos.conf.j2</tt> file:</p>
<div class="highlight"><pre><a name="code--ex19--configure.sh-session-jinja-idio.html-1"></a><span class="gp">$</span> cp /etc/rsyslog.d/mesos.conf /vagrant/mesos.conf.j2
</pre></div><p>Add this configuration to the Ansible <tt class="docutils literal">playbook.yml</tt> so this is fixed in the Master:</p>
<div class="highlight"><pre><a name="code--ex19--playbook.yml-jinja-idio.html-1"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">update the rsyslog config</span>
<a name="code--ex19--playbook.yml-jinja-idio.html-2"></a>        <span class="l-Scalar-Plain">template</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">src=./mesos.conf.j2 dest=/etc/rsyslog.d/mesos.conf</span>
<a name="code--ex19--playbook.yml-jinja-idio.html-3"></a>      <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">restart rsyslog</span>
<a name="code--ex19--playbook.yml-jinja-idio.html-4"></a>        <span class="l-Scalar-Plain">shell</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">service rsyslog restart</span>
</pre></div><p>You should put this directly after you update the hosts file.</p>
</div>
<div class="section" id="finding-errors">
<h1>Finding Errors</h1>
<p>With your messages files sorted, it's easier to troubleshoot.  A good place to start your troubleshooting process is in <tt class="docutils literal">/var/log/mesos/marathon.log</tt> to see what Marathon thinks is going
on.  The Marathon messages are no longer mixed together with Mesos and Chronos errors.</p>
<p>Another place to look is in the Mesos web UI at <a class="reference external" href="http://192.168.33.10:5050/">http://192.168.33.10:5050/</a> where you can see each node's Sandbox.  Watch the video for more information on this.</p>
<p>You can also use the <tt class="docutils literal">mesos tail</tt> command from the Mesos CLI to watch the <tt class="docutils literal">stderr/stdout</tt> of any listed command while you're trying to debug a problem.</p>
</div>
<div class="section" id="further-study">
<h1>Further Study</h1>
<ul class="simple">
<li>Configure the <tt class="docutils literal">rsyslogd</tt> for the slave nodes as well.</li>
</ul>
</div>
                <!-- RST ENDS -->

                <h2 id="comments"></h2>
                <p></p>
                <div id="disqus_thread"></div>

                <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


            </div>

        </div>

        <script type="text/javascript">
            !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.1";
                analytics.load("jb9aik674n");
                analytics.page()
            }}();
        </script>
    </div>
    <footer class=" ">
        <div class="container">
            <p align="center"><span class="text-muted"><a href="/support/" target="_blank">Support and feedback</a> | <a href="https://mesosphere.com/terms/" target="_blank">Terms of service</a> | <a href="https://mesosphere.com/privacy/" target="_blank">Privacy Policy</a> </span>
            <p align="center"><span class="text-muted">&copy; 2015 Mesosphere, Inc. All Rights Reserved.</span>
                <!-- div class="row">
                    <div class="col-sm-3">
                        <ul class="list-unstyled">
                            <li><a href="http://mesosphere.com/team/">Team</a>
                            <li><a href="http://mesosphere.com/news-events/">News &amp; Events</a></li>
                            <li><a href="http://mesosphere.com/jobs/">Careers</a>
                        </ul>
                    </div>
                    <div class="col-sm-3">
                        <ul class="list-unstyled">
                            <li><a href="http://mesosphere.com/resources/case-studies/">Case Studies</a>
                            <li><a href="http://mesosphere.com/resources/research/">Research</a>
                        </ul>
                    </div>
                    <div class="col-sm-3">
                        <ul class="list-unstyled">
                            <li><a href="https://twitter.com/mesosphere">@mesosphere</a>
                            <li><span class="text-muted">&copy; 2015 Mesosphere, Inc.</span>
                        </ul>
                    </div>
                </div -->
        </div>
    </footer>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/zeroclipboard/1.3.2/ZeroClipboard.min.js"></script>

</body>

</html>

